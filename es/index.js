function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var o,n=arguments[e];for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}).apply(this,arguments)}function addChild(e,o){if(null!=e)if("string"==typeof e||"number"==typeof e)o.push(e.toString());else if(Array.isArray(e))for(let t=0;t<e.length;t++)addChild(e[t],o);else o.push(e)}function h(t,e,...o){var n=[];return addChild(o,n),"function"==typeof t?t({...e,children:n}):{tag:t,props:e,children:n}}const DAY=864e5;function diffDays(t,e){t=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()),e=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());return Math.floor((e-t)/DAY)}function noop(){}function today(){var t=new Date;return t.setHours(0,0,0,0,0),t}function oneYearAgo(){var t=today();return t.setFullYear(t.getFullYear()-1),new Date(864e5*(7-t.getDay())+t.getTime())}const colors=["#f4f5f5","#daf6ea","#c7f0df","#82edc0","#0bd07d"];function rectColor(t){return t.count?45<t.count?colors[4]:30<t.count?colors[3]:15<t.count?colors[2]:colors[1]:colors[0]}function pad(t){return 9<t?""+t:"0"+t}function formatDate(t){var e=t.getFullYear(),o=t.getMonth()+1,t=t.getDate();return`${e}-${pad(o)}-`+pad(t)}function Days({values:t,size:r,space:e,padX:a,padY:o,colorFun:i,onClick:s,onHover:c,monthsPosition:n}){const l=r+2*e;let d="bottom"===n?o/2:o+e;return h("g",null,t.map((o,t)=>{const n=a+t*l+e;return h("g",null,o.map(t=>h("rect",{class:"node",x:n,y:t.day*l+d,rx:"2",ry:"2",width:r,height:r,fill:i(t),"data-count":t.count,"data-date":formatDate(t.date),onClick:()=>s(t),onMouseOver:()=>c(t)})),new Array(7-o.length).fill("block").map((t,e)=>h("rect",{class:"node",x:n,y:(o.length+e)*l+d,rx:"2",ry:"2",width:r,height:r,fill:"#fff",stroke:"#f4f5f5","stroke-width":"1px"})))}))}const MONTH=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Months({styles:o,values:t,size:e,space:r,padX:a,padY:n,customMonths:i,monthsPosition:s}){0<i.length&&i.length<MONTH.length&&(i=[],console.info("`customMonths` should include 12 months."));const c=e+2*r,l=2*c,d=[];let p=n/2;return t.forEach((t,n)=>{t.forEach((t,e)=>{var o;0===e&&0===t.day&&(e=t.date.getMonth(),t=n*c+a+r,!(o=d.slice(-1).pop())||e!==o.month&&t-o.x>l)&&d.push({month:e,x:t})})}),"bottom"===s&&(p=7*c+n-r),h("g",null,d.map((t,e)=>h("text",{key:e,x:t.x,y:p,style:o.text},(0<i.length?i:MONTH)[t.month])))}function DayTitles({styles:o,size:t,space:e,padX:n,padY:r,monthsPosition:a}){t+=2*e;let i=t/2;return"bottom"===a&&(i-=e+r/2),h("g",null,[{v:"M",y:r+ +t+i},{v:"W",y:r+3*t+i},{v:"F",y:r+5*t+i}].map((t,e)=>h("text",{key:e,x:n/2,y:t.y,style:o.text2},t.v)))}const SIZE="12px",TYPE='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';function getStyles({background:t="#fff",textColor:e="#959494",fontSize:o=SIZE,fontFamily:n=TYPE}){e={fill:e,"font-size":o,"font-family":n,"dominant-baseline":"central"};return{background:t,text:e,text2:{...e,"text-anchor":"middle"}}}function Graph({data:t=[],onClick:e=noop,colorFun:o=rectColor,startDate:n=oneYearAgo(),endDate:r=today(),size:a=12,space:i=1,padX:s=20,padY:c=20,monthsPosition:l="top",styleOptions:d={},showDayTitles:p=!0,showMonths:u=!0,customMonths:f=[],onHover:g=noop}){var y=[],m=diffDays(n,r),x=t.reduce((t,e)=>(t[e.date]=e.count,t),{});let v=0;for(let t=0;t<=m;t+=1){var k=new Date(n),b=(k.setDate(k.getDate()+t),k.getDay()),D=x[formatDate(k)]||0;(0===b&&0!==t||0===t)&&(y.push([]),v+=1),y[v-1].push({count:D,date:k,day:b})}var r=a+2*i,t=v*r+2*s,r=7*r+c+10,C=`0 0 ${t} `+r,d=getStyles(d),a={styles:d,values:y,size:a,space:i,colorFun:o,padX:s,padY:c,onClick:e,onHover:g,customMonths:f,monthsPosition:l};return h("svg",{width:t,height:r,viewBox:C},h("rect",{x:0,y:0,width:t,height:r,fill:d.background}),h(Days,a),u&&h(Months,a),p&&h(DayTitles,a))}const NS="http://www.w3.org/2000/svg",doc=document;function applyProperties(o,n){Object.keys(n).forEach(t=>{const e=n[t];"style"===t&&"object"==typeof e?Object.keys(e).forEach(t=>{o.style[t]=e[t]}):"onClick"===t?"function"==typeof e&&o.addEventListener("click",e):"onMouseOver"===t?"function"==typeof e&&o.addEventListener("mouseover",e):o.setAttribute(t,e)})}function render$2(t,e){var{tag:t,props:o,children:n}=t;const r=doc.createElementNS(NS,t);return o&&applyProperties(r,o),n.forEach(t=>{t&&r.appendChild("string"==typeof t?doc.createTextNode(t):render$2(t))}),r}class SVGGraph{constructor(t,e,o={}){this.dom="string"==typeof t?document.querySelector(t):t,this.data=e,this.options=o,this.render()}setData(t){this.data=t,this.render()}setOptions(t){this.options={...this.options,...t},this.render()}render(){var{data:t,options:e}=this;this.tree&&this.dom.removeChild(this.tree),this.tree=render$2(h(Graph,_extends({data:t},e))),this.dom.appendChild(this.tree)}}function render$1(t,e,o){var n,r,a,i,s,c,l,{tag:t,props:h,children:d}=t;"svg"===t&&({width:c,height:l}=h,e.width=c,e.height=l),"rect"===t&&({x:c,y:l,width:i,height:s,fill:n,stroke:r,onClick:a}=h,e.beginPath(),e.moveTo(c+2,l),e.lineTo(c+i-2,l),e.arc(c+i-2,l+2,2,1.5*Math.PI,2*Math.PI),e.lineTo(c+i,l+s-2),e.arc(c+i-2,l+s-2,2,0,.5*Math.PI),e.lineTo(c+2,l+s),e.arc(c+2,l+s-2,2,.5*Math.PI,Math.PI),e.lineTo(c,l+2),e.arc(c+2,l+2,2,Math.PI,1.5*Math.PI),o&&a&&e.isPointInPath(o.x,o.y)&&a(),e.closePath(),n&&(e.fillStyle=n,e.fill()),r)&&(e.strokeStyle=r,e.lineWidth=1,e.stroke()),"text"===t&&({x:i,y:s,style:c}=h,c&&(e.fillStyle=c.fill,l={start:"start",middle:"center",end:"end"},e.textBaseline={central:"middle",middle:"middle",hanging:"hanging",alphabetic:"alphabetic",ideographic:"ideographic"}[c["dominant-baseline"]]||"alphabetic",e.textAlign=l[c["text-anchor"]]||"start",e.font=`${c["font-weight"]||""} ${c["font-size"]} `+c["font-family"]),e.fillText(d.join(""),i,s)),d.forEach(t=>{"string"!=typeof t&&render$1(t,e,o)})}function createContext(t){const o="string"==typeof t?document.querySelector(t):t,n=o.getContext("2d");t=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;const r=(window.devicePixelRatio||1)/t;return["width","height"].forEach(e=>{Object.defineProperty(n,e,{get(){return o[e]/r},set(t){o[e]=t*r,o.style[e]=t+"px",n.scale(r,r)},enumerable:!0,configurable:!0})}),o.addEventListener("click",t=>{var e;n.onClick&&(e=o.getBoundingClientRect(),n.onClick({x:(t.clientX-e.left)*r,y:(t.clientY-e.top)*r}))}),n}class CanvasGraph{constructor(t,e,o={}){this.ctx=createContext(t),this.data=e,this.options=o,this.render(),this.ctx.onClick=t=>this.render(t)}setData(t){this.data=t,this.render()}setOptions(t){this.options={...this.options,...t},this.render()}render(t){var{data:e,options:o}=this;render$1(h(Graph,_extends({data:e},o)),this.ctx,t)}}function attrEscape(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}function escape(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")}function render(t,e){const{tag:o,props:n,children:r}=t,a=[];return a.push("<"+o),Object.keys(n||{}).forEach(t=>{let e=n[t];"onClick"!==t&&("style"===t&&"object"==typeof e&&(e=Object.keys(e).map(t=>`${t}:${e[t]};`).join("")),a.push(` ${t}="${attrEscape(e)}"`))}),r&&r.length?(a.push(">"),r.forEach(t=>{"string"==typeof t?a.push(escape(t)):a.push(render(t))}),a.push(`</${o}>`)):a.push(" />"),a.join("")}class StrGraph{constructor(t,e={}){this.data=t,this.options=e}setData(t){this.data=t}setOptions(t){this.options={...this.options,...t}}render(){var{data:t,options:e}=this;return render(h(Graph,_extends({data:t},e)))}}export{CanvasGraph,SVGGraph,StrGraph,CanvasGraph as default};
